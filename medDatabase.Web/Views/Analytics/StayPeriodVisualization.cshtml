@model medDatabase.Web.Models.StayPeriodVisualizationViewModel
@{
    ViewBag.Title = "StayPeriodVisualization";
}

<h2>Stay Period Analysis</h2>
@if (!Model.StayPeriodsInDays.Any())
{
    <p>
        No one with <strong>@Model.Illness.Name</strong> has every left the hospital...
    </p>
}
else
{
    <p>
        <strong>Average Stay Period:</strong> @Math.Abs(Math.Ceiling(Model.StayPeriodsInDays.Average())) Days
    </p>
    <p>
        See the chart visualization below for a graphical representation of patient stay periods.
    </p>

    <script type="text/javascript" src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="~/Scripts/plotly.js"></script>
    <div id="stayPeriodChart"></div>
    <script type="text/javascript">
        function camelize(str) {
            return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
        }

        var x = [];
        @for (var i = 0; i < Model.StayPeriodsInDays.Count(); i++)
        {
            @:x[@i] = @Math.Abs(Model.StayPeriodsInDays.ElementAt(i));
        }

        var trace = {
            x: x,
            type: 'histogram'
        };
        var data = [trace];
        var layout = {
            title: "Stay Period for Patients with " + camelize("@Model.Illness.Name"),
            xaxis: {
                title: "Stay Period (Days)"
            },
            yaxis: {
                title: "Number of Patients"
            },
            bargap: 0
        };
        Plotly.newPlot('stayPeriodChart', data, layout);
    </script>
}